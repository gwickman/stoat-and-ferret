# Quality Gaps: 002-rust-workspace

## Critical Gap: Rust Build Environment

### Issue
The Windows build environment is missing critical components for compiling Rust with the MSVC toolchain:

1. **Linker Conflict**: Git Bash's `/usr/bin/link.exe` (Unix link command) shadows MSVC's `link.exe`
2. **Missing Windows SDK**: Libraries like `kernel32.lib`, `ntdll.lib` are not found
3. **No MSVC Build Tools**: The C++ compiler and linker are not installed

### Error Message
```
error: linking with `link.exe` failed: exit code: 1
  = note: link: extra operand '...\build_script_build.*.rcgu.o'
          Try 'link --help' for more information.
```

The "extra operand" error is from the Unix `link` command, not MSVC.

### Impact
- Cannot run `maturin develop` to build the Python extension
- Cannot run `cargo clippy` or `cargo test`
- The Rust quality gates cannot be verified

### Resolution
Install **Visual Studio Build Tools 2022**:
1. Download from https://visualstudio.microsoft.com/downloads/ (scroll to "Tools for Visual Studio")
2. Run the installer and select "Desktop development with C++" workload
3. This installs:
   - MSVC compiler and linker
   - Windows SDK
   - Required libraries

After installation, either:
- Open a new "Developer Command Prompt for VS" to build, or
- Ensure the MSVC paths are in your PATH before Git Bash paths

## Workaround Applied

To allow Python development to continue:
1. The `pyproject.toml` uses `hatchling` as build backend (instead of `maturin`)
2. The `stoat_ferret_core/__init__.py` catches `ImportError` and provides a stub that raises `RuntimeError`
3. Type stubs were created manually in `stubs/stoat_ferret_core/`

This allows:
- Python linting and type checking to pass
- Tests to run (testing the stub behavior)
- Development of Python-only code to continue

## Tech Debt

1. **Manual Type Stubs**: Stubs should be generated by `pyo3-stub-gen` from Rust code
2. **Hatchling Backend**: Should switch to `maturin` once build environment is fixed
3. **Rust Quality Gates**: Cannot verify clippy or cargo test until build works
