# Impact Assessment Table: v006

| # | Area | Description | Classification | Resulting Work Item | Caused By |
|---|------|-------------|----------------|---------------------|-----------|
| 1 | Type stubs | New Rust types (expression AST, graph validator, composition API) need type stubs in `stubs/stoat_ferret_core/_core.pyi` | small | Add type stubs for all new PyO3 types as part of each Rust feature (BL-037, BL-038, BL-039, BL-040, BL-041) | BL-037, BL-038, BL-039, BL-040, BL-041 |
| 2 | `lib.rs` module registration | New Rust modules (expressions, graph_validation, composition, drawtext, speed) must be registered in `_core` PyO3 module | small | Extend `lib.rs` module registration for each new module — handled per-feature per incremental bindings rule | BL-037, BL-038, BL-039, BL-040, BL-041 |
| 3 | AGENTS.md Rust module structure | AGENTS.md documents Rust module structure as `timeline`, `filters`, `commands`, `sanitize`; v006 adds `expressions`, `graph_validation`/`composition` (or extends `filters`). The documented module list will become incomplete | small | Update AGENTS.md Rust module listing after Rust features complete | BL-037, BL-038, BL-039 |
| 4 | AGENTS.md project structure | Project structure tree shows `src/` layout but no `src/stoat_ferret/api/routers/effects.py` or `src/stoat_ferret/api/schemas/effect.py` — these will be added by BL-042/BL-043 | small | Update AGENTS.md project structure tree after API features complete | BL-042, BL-043 |
| 5 | 05-api-specification.md — Effects endpoints | The API spec documents `GET /effects`, `POST /effects`, `POST /projects/{id}/clips/{id}/effects` etc. in aspirational detail. v006 implements a subset (discovery + text overlay apply). The spec may need annotations about which endpoints are implemented vs planned | small | Review 05-api-specification.md for consistency with actual implementation after BL-042/BL-043 | BL-042, BL-043 |
| 6 | 02-architecture.md — Rust Core Module Structure | Architecture doc shows Rust module structure with `filters` and `commands` modules. v006 adds new modules or significantly extends `filters` (expressions, graph validation, composition, drawtext, speed builders) | small | Update 02-architecture.md Rust module listing after v006 implementation | BL-037, BL-038, BL-039, BL-040, BL-041 |
| 7 | 02-architecture.md — Effects Service description | Architecture doc describes an `Effects Service` with responsibilities including effect composition/chaining and discovery. v006 partially implements this (discovery via BL-042, apply via BL-043). Description should match implementation | small | Verify Effects Service description in 02-architecture.md aligns with actual BL-042/BL-043 implementation | BL-042, BL-043 |
| 8 | 02-architecture.md — Filter Builder code example | Architecture doc has code example `build_text_overlay_filter()` as a standalone function. v006's BL-040 implements this as a builder struct with PyO3 bindings, not a standalone function. Example will become misleading | small | Update filter builder code example in 02-architecture.md to match builder pattern from BL-040 | BL-040 |
| 9 | Clip data model — effects field | BL-043 requires storing effect configurations on clips. The current clip model (`src/stoat_ferret/api/schemas/clip.py`, `src/stoat_ferret/db/clip_repository.py`, and Rust `Clip` type) has no `effects` field. This is a schema change that touches multiple layers | substantial | Design and implement clip effects storage: extend clip schema, repository, and Rust Clip type to support an effects list. This should be scoped as a dedicated feature or a major sub-task of BL-043 | BL-043 |
| 10 | 01-roadmap.md — Phase 2 milestone tracking | Roadmap M2.1, M2.2, M2.3 are partially implemented by v006. Milestone checkboxes should be updated to reflect completion status after v006 | small | Update Phase 2 milestone checkboxes in 01-roadmap.md after v006 completion | BL-037, BL-038, BL-039, BL-040, BL-041, BL-042, BL-043 |
| 11 | Contract test infrastructure | BL-040 AC5 requires `ffmpeg -filter_complex` contract tests. The existing contract test infrastructure (from v004 record-replay pattern) may need extension for filter-level validation as opposed to full command validation | small | Extend contract test infrastructure to support filter-level validation for BL-040, leveraging existing FFmpegExecutor recording pattern | BL-040 |
| 12 | CI matrix — FFmpeg contract tests | Per LRN-015, FFmpeg contract tests should run on a single CI matrix entry. If BL-040 adds new contract tests, the CI workflow may need a configuration update to avoid running expensive filter validation across all platforms | small | Verify CI workflow handles new contract tests on single matrix entry; update `.github/workflows/` if needed | BL-040 |
| 13 | Effect registration pattern — Python service | BL-042 requires an effect registry that BL-040 and BL-041 register into. No Python effect service or registry pattern exists yet. This requires designing a new service with DI integration via `create_app()` kwargs | substantial | Design effect registry service with DI pattern, following existing `create_app()` kwargs convention. Should be a dedicated feature within the BL-042 theme | BL-042 |
| 14 | WebSocket event types | When effects are applied to clips (BL-043), the system should emit WebSocket events. The current event types in `ws.py`/`events.py` don't include effect-related events | small | Add effect-related WebSocket event types (e.g., `effect.applied`, `effect.removed`) as part of BL-043 implementation | BL-043 |
