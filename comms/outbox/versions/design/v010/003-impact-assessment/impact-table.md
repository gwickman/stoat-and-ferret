# Impact Table — v010

| # | Area | Description | Classification | Resulting Work Item | Caused By |
|---|------|-------------|----------------|---------------------|-----------|
| 1 | caller-impact | `jobs.py:38-43` constructs `JobStatusResponse` from `JobResult` but never passes `progress` — response will always show `progress: null` even after queue tracks progress | substantial | Wire `progress` field from `JobResult`/`_AsyncJobEntry` through `get_result()` into `JobStatusResponse` in `jobs.py` router | BL-073 |
| 2 | caller-impact | `InMemoryJobQueue` (test double) has no `set_progress()` or `cancel()` methods — tests using it will fail when production code calls these new APIs | substantial | Add `set_progress()` and `cancel()` to `InMemoryJobQueue` and update `AsyncJobQueue` protocol | BL-073, BL-074 |
| 3 | caller-impact | `scan.py:154` calls `ffprobe_video()` synchronously — when BL-072 converts it to async, the scan handler must `await` the new async version | small | Update `scan_directory()` to await async `ffprobe_video()` | BL-072 |
| 4 | caller-impact | `scan.py` handler has no cancellation check in the file iteration loop (lines 140-188) — cancel flag will never be checked even after BL-074 adds the mechanism | substantial | Add cancellation check inside scan file loop; pass cancellation token/flag into `scan_directory()` | BL-074 |
| 5 | caller-impact | `scan.py` handler has no progress reporting call — progress will never be reported even after BL-073 adds `set_progress()` to the queue | substantial | Add `set_progress()` calls in scan loop, passing `scanned/total_files` ratio | BL-073 |
| 6 | caller-impact | `make_scan_handler()` signature lacks `job_id` access — handler receives `(job_type, payload)` but `set_progress(job_id, value)` needs the job_id | substantial | Extend handler signature or provide job context so handlers can call `set_progress()` | BL-073 |
| 7 | caller-impact | `ScanModal.tsx:186-188` cancel button is disabled during scanning (`disabled={scanStatus === 'scanning'}`) and calls `onClose` not a cancel API — it won't call the new cancel endpoint | substantial | Enable cancel button during scan and wire it to call `DELETE /api/v1/jobs/{id}` or `POST /api/v1/jobs/{id}/cancel` | BL-074 |
| 8 | caller-impact | `JobStatus` enum has no `CANCELLED` value — cancelled jobs have no status representation | small | Add `CANCELLED = "cancelled"` to `JobStatus` enum | BL-074 |
| 9 | documentation | `docs/C4-Documentation/c4-code-stoat-ferret-ffmpeg.md:17-20` documents `ffprobe_video` as sync with `subprocess` dependency — will be stale after async conversion | small | Update C4 ffmpeg code doc: change `subprocess` to `asyncio.subprocess`, mark function as async | BL-072 |
| 10 | documentation | `docs/C4-Documentation/c4-code-stoat-ferret-jobs.md:51-61` documents `AsyncioJobQueue` without `set_progress()`, `cancel()`, or progress fields — will be incomplete | small | Update C4 jobs code doc to include new methods and fields | BL-073, BL-074 |
| 11 | documentation | `docs/C4-Documentation/c4-code-stoat-ferret-api-schemas.md:95-97` documents `JobStatusResponse` without mentioning the `cancelled` status or progress semantics | small | Update C4 schemas doc with `cancelled` status and progress field semantics | BL-073, BL-074 |
| 12 | documentation | `docs/manual/03_api-reference.md:577,978-984` documents job status endpoint — `progress` field is listed but documented as always null; cancel endpoint is absent | small | Update API reference: document progress values during scan, add cancel endpoint section | BL-073, BL-074 |
| 13 | documentation | `docs/manual/07_rendering-guide.md:74` references `POST /api/v1/render/cancel/{job_id}` as planned — v010 adds a generic cancel endpoint that may supersede this design | small | Review rendering guide cancel endpoint against v010 cancel implementation for consistency | BL-074 |
| 14 | documentation | `docs/design/05-api-specification.md` has a render cancel endpoint but no generic job cancel endpoint — the design spec will be out of sync with implementation | small | Add generic job cancel endpoint to API specification design doc | BL-074 |
| 15 | documentation | `docs/CHANGELOG.md` will need v010 entries for async ffprobe, progress reporting, cancellation, CI quality gate, and integration test | small | Add v010 changelog entries after implementation | All |
| 16 | ci-config | `.github/workflows/ci.yml` has no step for the blocking-call quality gate — BL-077's new CI script needs integration into the workflow | small | Add blocking-call check step to CI workflow (part of BL-077 implementation) | BL-077 |
| 17 | test-fixtures | 6 test conftest files create `InMemoryJobQueue()` — all will need updates when protocol changes for progress/cancel | small | Update test fixtures after `InMemoryJobQueue` gains new methods (covered by BL-073/BL-074 implementation) | BL-073, BL-074 |
| 18 | test-mocks | `tests/test_api/test_videos.py` mocks `ffprobe_video` at 6 call sites — mock targets may change if function signature becomes async | small | Update mock targets if `ffprobe_video` import path or signature changes | BL-072 |
